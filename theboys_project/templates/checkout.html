<!-- checkout.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Checkout</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="form-container">
    <h2>Checkout</h2>
    
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="flash-messages">
          {% for message in messages %}
            <div class="flash-message">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <div class="order-summary">
      <h3>Order Summary</h3>
      {% for item in cart_items %}
        <div class="order-item">
          <span class="item-name">{{ item[1] }}</span>
          <span class="item-quantity">({{ item[3] }} ï¿½ ?{{ item[2] }})</span>
          <span class="item-total">?{{ item[2] * item[3] }}</span>
        </div>
      {% endfor %}
      <hr>
      <div class="order-totals">
        <div class="subtotal">
          <span>Subtotal:</span>
          <span>?{{ total }}</span>
        </div>
        <div class="delivery">
          <span>Delivery Charge:</span>
          <span>?{{ delivery_charge }}</span>
        </div>
        <div class="grand-total">
          <span>Total:</span>
          <span>?{{ total + delivery_charge }}</span>
        </div>
      </div>
    </div>
    
    <form method="POST">
      <div class="form-group">
        <label for="address">Delivery Address:</label>
        <textarea name="address" id="address" required>{{ user_address }}</textarea>
      </div>
      
      <div class="form-group">
        <label for="phone">Phone Number:</label>
        <input type="tel" name="phone" id="phone" 
               value="{{ user_phone }}" 
               placeholder="Enter your phone number" 
               pattern="[0-9]{10}" 
               title="Please enter a 10-digit phone number"
               required>
      </div>
      
      <div class="form-group">
        <label for="payment_method">Payment Method:</label>
        <select name="payment_method" id="payment_method" required>
          <option value="">Select Payment Method</option>
          <option value="Cash on Delivery">Cash on Delivery</option>
          <option value="Credit Card">Credit Card</option>
          <option value="Debit Card">Debit Card</option>
          <option value="UPI">UPI Payment</option>
        </select>
      </div>
      
      <div class="form-actions">
        <button type="submit" class="btn">Place Order</button>
        <a href="/view_cart" class="btn secondary">Back to Cart</a>
      </div>
    </form>
  </div>

  <script src="{{ url_for('static', filename='script.js') }}"></script>
  <script>
    // Client-side phone number validation
    document.querySelector('form').addEventListener('submit', function(e) {
      const phoneInput = document.getElementById('phone');
      if (!/^\d{10}$/.test(phoneInput.value)) {
        e.preventDefault();
        alert('Please enter a valid 10-digit phone number');
        phoneInput.focus();
      }
    });
  </script>
</body>
</html>